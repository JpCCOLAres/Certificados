// Dados completos dos voluntários
const voluntarios = {
  "VOL-2025-IVFS-0001": {
    nome: "Maria Marina Vizioli Pedroso da Cruz",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0002": {
    nome: "Mark Twain Duarte Siqueira",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0003": {
    nome: "Anna Victória Almeida Fernandes",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0004": {
    nome: "Djulia de Gois Alves Pereira",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0005": {
    nome: "Samuel Fonseca Melo",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0006": {
    nome: "Ana Dávila Laurindo Rabelo",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0007": {
    nome: "MARIA JULIA DA MATA CAMPOS COSTA",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0008": {
    nome: "Gabriella Borges Sidião",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0009": {
    nome: "Hugo Cordeiro da Silva",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0010": {
    nome: "Anderson Porto Frattane Filho",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0011": {
    nome: "Vitória Carolayne Campos de Oliveira	",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0012": {
    nome: "Alline Áurea do Amaral Pirchio",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0013": {
    nome: "Felipe Bueno Ribeiro",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0014": {
    nome: "ELIZA SAYURI MOLITOR",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0015": {
    nome: "Giovana de Godoy Trippia",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0016": {
    nome: "Andressa Teixeira Ibraim",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0017": {
    nome: "Ana Laura Beraldi Cordella",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0018": {
    nome: "Maria Luiza da Mata Campos Costa",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0019": {
    nome: "Pedro Martin Barrios Luongo",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0020": {
    nome: "Ana Clara Luz Pereira",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0021": {
    nome: "Victória Bertine Barreiro",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0022": {
    nome: "Bianca Toyota Pinto",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0023": {
    nome: "José Mardeson Alexandre Felipe",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0024": {
    nome: "Gustavo Silva Esteves",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0025": {
    nome: "Bruna Milena de Bem Silva",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0026": {
    nome: "Sthéfany Spetanieri Santos",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0027": {
    nome: "Fúvia karolline Hipólito Duarte Cunha",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0028": {
    nome: "Ana Luiza Barbosa",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0029": {
    nome: "Állex Silva Alves",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0030": {
    nome: "Jéssica Marques Ferro",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0031": {
    nome: "Dalciane Rodrigues de Souza",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0032": {
    nome: "Luana Bibiano Anastacio",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
};

// Lista de pastas onde os PDFs estão divididos (em ordem)
const pastasPDFs = Array.from({ length: 10 }, (_, i) => `parte_${i + 1}`);

// Função para buscar certificado nas subpastas
function buscarCertificado(codigo) {
  // Verifica se o código existe nos voluntários
  if (!voluntarios[codigo]) {
    return { existe: false };
  }

  // Calcula em qual pasta o arquivo deve estar
  const numero = parseInt(codigo.split("-")[4]);
  let parte;

  // Lógica especial para parte_10 (certificados 28-31)
  if (numero >= 28 && numero <= 31) {
    parte = 10;
  } else {
    parte = Math.ceil(numero / 3); // 3 certificados por pasta para 1-27
  }

  const pasta = `parte_${parte}`;
  const caminho = `${pasta}/${codigo}.pdf`;

  return {
    ...voluntarios[codigo],
    caminho: caminho,
    existe: true,
  };
}

// Função para escape HTML (segurança)
function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

// Event Listener para o formulário
document
  .getElementById("formCertificado")
  .addEventListener("submit", function (e) {
    e.preventDefault();

    const codigo = document.getElementById("codigo").value.trim().toUpperCase();
    const resultadoDiv = document.getElementById("resultado");

    // Feedback visual durante a busca
    resultadoDiv.innerHTML =
      '<div class="loading">Buscando certificado...</div>';

    setTimeout(() => {
      try {
        const resultado = buscarCertificado(codigo);

        if (resultado.existe) {
          resultadoDiv.innerHTML = `
                  <div class="certificado-encontrado">
                      <h2>Certificado Encontrado</h2>
                      <p><strong>Nome:</strong> ${escapeHtml(
                        resultado.nome
                      )}</p>
                      <p><strong>Projeto:</strong> ${escapeHtml(
                        resultado.projetovoluntario
                      )}</p>
                      <p><strong>Carga Horária:</strong> ${escapeHtml(
                        resultado.cargahoraria
                      )}</p>
                      <p><strong>Código:</strong> ${escapeHtml(codigo)}</p>
                      <a href="${
                        resultado.caminho
                      }" download="${codigo}.pdf" class="btn-download">
                          Baixar Certificado
                      </a>
                      <p class="nota">Se o download não iniciar automaticamente, <a href="${
                        resultado.caminho
                      }" target="_blank">clique aqui</a>.</p>
                  </div>`;
        } else {
          resultadoDiv.innerHTML =
            '<div class="erro">Certificado não encontrado. Verifique o código e tente novamente.</div>';
        }
      } catch (error) {
        console.error("Erro:", error);
        resultadoDiv.innerHTML =
          '<div class="erro">Ocorreu um erro ao buscar o certificado. Tente novamente mais tarde.</div>';
      }
    }, 100);
  });
