// Dados completos dos voluntários
const voluntarios = {
  "VOL-2025-IVFS-0001": {
    nome: "Ana Luiza Barbosa",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0002": {
    nome: "Mark Twain Duarte Siqueira",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0003": {
    nome: "Anna Victória Almeida Fernandes",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0004": {
    nome: "Djulia de Gois Alves Pereira",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0005": {
    nome: "Samuel Fonseca Melo",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0006": {
    nome: "Ana Dávila Laurindo Rabelo",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0007": {
    nome: "MARIA JULIA DA MATA CAMPOS COSTA",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0008": {
    nome: "Gabriella Borges Sidião",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0009": {
    nome: "Hugo Cordeiro da Silva",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0010": {
    nome: "Anderson Porto Frattane Filho",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0011": {
    nome: "Fulano de Tal",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0012": {
    nome: "Ciclano da Silva",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0013": {
    nome: "Beltrano Oliveira",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0014": {
    nome: "João dos Santos",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0015": {
    nome: "Maria Souza",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0016": {
    nome: "José Pereira",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0017": {
    nome: "Ana Costa",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0018": {
    nome: "Carlos Mendes",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0019": {
    nome: "Patrícia Alves",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0020": {
    nome: "Ricardo Nunes",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0021": {
    nome: "Fernanda Lima",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0022": {
    nome: "Roberto Andrade",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0023": {
    nome: "Amanda Santos",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0024": {
    nome: "Lucas Ferreira",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0025": {
    nome: "Juliana Martins",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0026": {
    nome: "Marcos Vinícius",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0027": {
    nome: "Tatiane Gomes",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0028": {
    nome: "Gustavo Henrique",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0029": {
    nome: "Camila Rodrigues",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0030": {
    nome: "Jéssica Marques Ferro",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
  "VOL-2025-IVFS-0031": {
    nome: "Dalciane Rodrigues de Souza",
    projetovoluntario: "Ação Saúde e Comunidade",
    cargahoraria: "5h",
  },
};

// Lista de pastas onde os PDFs estão divididos (em ordem)
const pastasPDFs = Array.from({ length: 10 }, (_, i) => `parte_${i + 1}`);

// Função para buscar certificado nas subpastas
function buscarCertificado(codigo) {
  // Verifica se o código existe nos voluntários
  if (!voluntarios[codigo]) {
    return { existe: false };
  }

  // Calcula em qual pasta o arquivo deve estar
  const numero = parseInt(codigo.split("-")[3]);
  const parte = Math.ceil(numero / 3); // 3 certificados por pasta
  const pasta = `parte_${Math.min(parte, 10)}`; // Limita a 10 pastas

  return {
    ...voluntarios[codigo],
    caminho: `${pasta}/${codigo}.pdf`, // Removido 'certificados/' do caminho
    existe: true,
  };
}

// Função para escape HTML (segurança)
function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

// Event Listener para o formulário
document
  .getElementById("formCertificado")
  .addEventListener("submit", function (e) {
    e.preventDefault();

    const codigo = document.getElementById("codigo").value.trim().toUpperCase();
    const resultadoDiv = document.getElementById("resultado");

    // Feedback visual durante a busca
    resultadoDiv.innerHTML =
      '<div class="loading">Buscando certificado...</div>';

    setTimeout(() => {
      try {
        const resultado = buscarCertificado(codigo);

        if (resultado.existe) {
          resultadoDiv.innerHTML = `
                  <div class="certificado-encontrado">
                      <h2>Certificado Encontrado</h2>
                      <p><strong>Nome:</strong> ${escapeHtml(
                        resultado.nome
                      )}</p>
                      <p><strong>Projeto:</strong> ${escapeHtml(
                        resultado.projetovoluntario
                      )}</p>
                      <p><strong>Carga Horária:</strong> ${escapeHtml(
                        resultado.cargahoraria
                      )}</p>
                      <p><strong>Código:</strong> ${escapeHtml(codigo)}</p>
                      <a href="${
                        resultado.caminho
                      }" download="${codigo}.pdf" class="btn-download">
                          Baixar Certificado
                      </a>
                      <p class="nota">Se o download não iniciar automaticamente, <a href="${
                        resultado.caminho
                      }" target="_blank">clique aqui</a>.</p>
                  </div>`;
        } else {
          resultadoDiv.innerHTML =
            '<div class="erro">Certificado não encontrado. Verifique o código e tente novamente.</div>';
        }
      } catch (error) {
        console.error("Erro:", error);
        resultadoDiv.innerHTML =
          '<div class="erro">Ocorreu um erro ao buscar o certificado. Tente novamente mais tarde.</div>';
      }
    }, 100);
  });
